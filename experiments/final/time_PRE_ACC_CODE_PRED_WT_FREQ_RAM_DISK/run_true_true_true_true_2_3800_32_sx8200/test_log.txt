

# Freq
for c in 3 4 5 15 16 17; do cpufreq-set -c $c -f '3800MHz' || exit 10; done
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 3 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 4 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 5 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 15 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 16 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 17 -f 3800MHz

# Prep
cd el15066/erigon/
+ cd el15066/erigon/

# Globals
cat common/globals_time_PRE_ACC_CODE_PRED_WT.go.template |
  sed 's/%PRE%/true/g' |
  sed 's/%ACC%/true/g' |
  sed 's/%CODE%/true/g' |
  sed 's/%PRED%/true/g' |
  sed 's/%WT%/2/g' |
tee common/globals.go
+ cat common/globals_time_PRE_ACC_CODE_PRED_WT.go.template
+ sed s/%PRE%/true/g
+ sed s/%ACC%/true/g
+ sed s/%CODE%/true/g
+ sed s/%PRED%/true/g
+ sed s/%WT%/2/g
+ tee common/globals.go

package common

const MAX_BLOCK = 10_500_000 - 1 + 30_000

const  STORAGE_TRACING = false
const       TX_DUMPING = false
const     CODE_DUMPING = false
const     JUMP_TRACING = false

const PREFETCH_BLOCKS           = true
const BLOCK_READAHEAD           = 2
const PREFETCH_ACCOUNTS         = true
const PREFETCH_CODE             = true
const USE_PREDICTORS            = true
const USE_STORAGE_PREFETCH_FILE = false

const PREFETCH_WORKERS_COUNT = 2

const TRACE_PREDICTED = false

const DEBUG_TX       = false
const DEBUG_TX_BLOCK = 0
const DEBUG_TX_INDEX = 0

const PREDICTOR_CACHE_SIZE      = 1024
const PREDICTOR_GAS_TO_GAZ_RATE = 64 // div 1024
const PREDICTOR_CALL_GAZ_BONUS  = 0
const PREDICTOR_RESERVE_GAZ_DIV = 2
const PREDICTOR_DB_PATH         = "dbdir/predictorDB_new"



// if CODE_DUMPING {
var CONTRACT_CODE       = map[Hash][]byte{}
var CONTRACT_CODE_COUNT = map[Hash]uint{}
var CONTRACT_CODE_ALIAS = map[Address]Hash{}
// }

var CALLID         = -1 // JUMP_TRACING
var CALLID_COUNTER =  0 // JUMP_TRACING

// if JUMP_TRACING {
var JUMP_COUNT         = map[Hash]uint{}
var JUMP_CALLS         = map[Hash]map[int]struct{}{}
var JUMP_DST_CALLCOUNT = map[Hash]map[uint32]map[uint32]map[int]uint{}
// }

# Disk
rm dbdir
+ rm dbdir
ln -s '/media/route/sx8200/' dbdir
+ ln -s /media/route/sx8200/ dbdir

# Caches
echo 3 >/proc/sys/vm/drop_caches
+ echo 3

# Make
sudo -u '#1000' make erigon
+ sudo -u '#1000' make erigon
Building Erigon
rm -f /home/route/el15066/erigon/build/bin/tg # Remove old binary to prevent confusion where users still use it because of the scripts
env GO111MODULE=on go build -trimpath -ldflags "-X github.com/ledgerwatch/erigon/params.GitCommit=a7e2b17a9911ebe848dc4f09dd1557bb4013f4c3 -X github.com/ledgerwatch/erigon/params.GitBranch=inline_uv -X github.com/ledgerwatch/erigon/params.GitTag=v2021.08.05-361-ga7e2b17a9" -o /home/route/el15066/erigon/build/bin/erigon ./cmd/erigon
Done building.
Run "/home/route/el15066/erigon/build/bin/erigon" to launch Erigon.

# Mkdir
mkdir '../experiments/final/time_PRE_ACC_CODE_PRED_WT_FREQ_RAM_DISK/run_true_true_true_true_2_3800_32_sx8200/' || true
+ mkdir ../experiments/final/time_PRE_ACC_CODE_PRED_WT_FREQ_RAM_DISK/run_true_true_true_true_2_3800_32_sx8200/

# Sleep
sleep 123
+ sleep 123

# Reserve RAM
[ ! -e /tmp2/fifo ] && mkfifo /tmp2/fifo
+ '[' '!' -e /tmp2/fifo ']'
python3 ../experiments/reserve_ram_until.py '32' >/tmp2/fifo &
PID=$!
+ PID=925166
exec 3</tmp2/fifo
+ exec
+ python3 ../experiments/reserve_ram_until.py 32
read -u 3
+ read -u 3
Will reserve: 29689 MiB
Random: 1855 MiB
Copying all that 14 times
Copying a few more MiB
Done, undershoot by 640 KiB
exec 3>&-
+ exec

# Sleep
sleep 23
+ sleep 23

# Run
_T0=$(date +%s.%3N)
++ date +%s.%3N
+ _T0=1645395137.712
nice --10 taskset -c 3-5,16-17 ./build/bin/erigon --datadir dbdir/erigon/data/ --ethash.dagdir dbdir/erigon/ethash/ --nodiscover --port 30123 |& tee -i '../experiments/final/time_PRE_ACC_CODE_PRED_WT_FREQ_RAM_DISK/run_true_true_true_true_2_3800_32_sx8200/erigon_log.txt'
+ nice --10 taskset -c 3-5,16-17 ./build/bin/erigon --datadir dbdir/erigon/data/ --ethash.dagdir dbdir/erigon/ethash/ --nodiscover --port 30123
+ tee -i ../experiments/final/time_PRE_ACC_CODE_PRED_WT_FREQ_RAM_DISK/run_true_true_true_true_2_3800_32_sx8200/erigon_log.txt
[INFO] [02-20|22:12:17.802] Build info                               git_branch=inline_uv git_tag=v2021.08.05-361-ga7e2b17a9 git_commit=a7e2b17a9911ebe848dc4f09dd1557bb4013f4c3
[INFO] [02-20|22:12:17.802] Starting Erigon on Ethereum mainnet... 
[INFO] [02-20|22:12:17.803] Maximum peer count                       ETH=100 total=100
[INFO] [02-20|22:12:17.804] Set global gas cap                       cap=50000000
[INFO] [02-20|22:12:17.844] Opening Database                         label=chaindata path=dbdir/erigon/data/chaindata
[INFO] [02-20|22:12:17.846] database closed                          label=chaindata
[INFO] [02-20|22:12:17.846] Opening Database                         label=chaindata path=/home/route/el15066/erigon/dbdir/erigon/data/chaindata
[INFO] [02-20|22:12:17.848] Initialised chain configuration          config="{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, London: 12965000, Engine: ethash}"
[INFO] [02-20|22:12:17.849] Disk storage enabled for ethash DAGs     dir=dbdir/erigon/ethash count=2
[INFO] [02-20|22:12:17.849] Initialising Ethereum protocol           network=1
[INFO] [02-20|22:12:17.849] Effective                                prune="--prune="
[INFO] [02-20|22:12:17.849] Starting private RPC server              on=127.0.0.1:9090
[INFO] [02-20|22:12:19.176] Stage Headers                   (Download headers) 
[INFO] [02-20|22:12:19.176] Stage Headers                   Done 
[INFO] [02-20|22:12:19.176] Stage BlockHashes               (Write block hashes) 
[INFO] [02-20|22:12:19.176] Stage BlockHashes               Done 
[INFO] [02-20|22:12:19.176] Stage CreateHeadersSnapshot     disabled. Enable by --snapshot.layout 
[INFO] [02-20|22:12:19.176] Stage Bodies                    (Download block bodies) 
[INFO] [02-20|22:12:19.176] Stage Bodies                    Done 
[INFO] [02-20|22:12:19.176] Stage CreateBodiesSnapshot      disabled. Enable by --snapshot.layout 
[INFO] [02-20|22:12:19.176] Stage Senders                   (Recover senders from tx signatures) 
[INFO] [02-20|22:12:19.176] Stage Senders                   Done 
[INFO] [02-20|22:12:19.176] Stage Execution                 (Execute blocks w/o hash checks) 
[INFO] [02-20|22:12:19.176] [7/18 Execution] Blocks execution        from=10499999 to=10529999
[INFO] [02-20|22:12:19.176] Globals                                  STORAGE_TRACING=false TX_DUMPING=false CODE_DUMPING=false JUMP_TRACING=false PREFETCH_BLOCKS=true BLOCK_READAHEAD=2 PREFETCH_ACCOUNTS=true PREFETCH_CODE=true USE_PREDICTORS=true USE_STORAGE_PREFETCH_FILE=false PREFETCH_WORKERS_COUNT=2 TRACE_PREDICTED=false DEBUG_TX=false DEBUG_TX_BLOCK=0 DEBUG_TX_INDEX=0 PREDICTOR_CACHE_SIZE=1024 PREDICTOR_GAS_TO_GAZ_RATE=64 PREDICTOR_RESERVE_GAZ_DIV=2 PREDICTOR_CALL_GAZ_BONUS=0 PREDICTOR_DB_PATH=dbdir/predictorDB_new
[INFO] [02-20|22:12:19.178] Opened database                          package=predictorDB info=/home/route/el15066/erigon/symbolic/sandbox/envon_test/code//,0f5d3b1_10500K
[INFO] [02-20|22:12:19.189] Started P2P networking                   version=65 self="enode://cf90152aad373d1608af933850566e82f8ad78089ffe361b9f94664a081ba07596b6dbf4b38dfdde9f4a7470414f76c803b66ad56e4920db7bb09fa445d3c458@127.0.0.1:30304?discport=0" name=erigon/v2021.08.5-alpha-a7e2b17a/linux-amd64/go1.16.14
[INFO] [02-20|22:12:19.195] Started P2P networking                   version=66 self="enode://cf90152aad373d1608af933850566e82f8ad78089ffe361b9f94664a081ba07596b6dbf4b38dfdde9f4a7470414f76c803b66ad56e4920db7bb09fa445d3c458@127.0.0.1:30123?discport=0" name=erigon/v2021.08.5-alpha-a7e2b17a/linux-amd64/go1.16.14
[INFO] [02-20|22:12:49.183] [7/18 Execution] Executed blocks         number=10501496 blk/s=49.889 tx/s=9543.370 Mgas/s=575.138 batch="39.93 MiB" alloc="324.66 MiB" sys="544.48 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          51243           1497          76712
   4-   3       19992311           1497       29928490
   9-   8            116           1496            174
  10-   9             30           1496             45
  11-  10             30           1496             45
[INFO] [02-20|22:13:19.178] [7/18 Execution] Executed blocks         number=10503113 blk/s=53.909 tx/s=10363.396 Mgas/s=609.804 batch="76.60 MiB" alloc="418.31 MiB" sys="679.39 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          32760           3114         102017
   4-   3       19234681           3114       59896797
   9-   8            117           3113            365
  10-   9             30           3113             95
  11-  10             30           3113             95
[INFO] [02-20|22:13:49.180] [7/18 Execution] Executed blocks         number=10504670 blk/s=51.897 tx/s=8758.506 Mgas/s=584.421 batch="110.68 MiB" alloc="619.56 MiB" sys="814.39 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          32916           4671         153750
   4-   3       19234666           4671       89845125
   9-   8            118           4670            551
  10-   9             30           4670            142
  11-  10             30           4670            143
[INFO] [02-20|22:14:17.850] [p2p] GoodPeers                          eth66=0 eth65=0
[INFO] [02-20|22:14:19.181] [7/18 Execution] Executed blocks         number=10506171 blk/s=50.032 tx/s=7449.755 Mgas/s=578.280 batch="148.02 MiB" alloc="544.78 MiB" sys="883.26 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          26432           6172         163141
   4-   3       19415905           6172      119834966
   9-   8            119           6171            734
  10-   9             30           6171            189
  11-  10             30           6171            189
[INFO] [02-20|22:14:49.184] [7/18 Execution] Executed blocks         number=10507757 blk/s=52.861 tx/s=10382.279 Mgas/s=609.249 batch="179.71 MiB" alloc="683.10 MiB" sys="1019.02 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          22153           7758         171868
   4-   3       19312725           7758      149828127
   9-   8            118           7757            919
  10-   9             30           7757            237
  11-  10             30           7757            237
[INFO] [02-20|22:15:19.218] [7/18 Execution] Executed blocks         number=10509337 blk/s=52.607 tx/s=9966.656 Mgas/s=601.267 batch="212.01 MiB" alloc="843.64 MiB" sys="1.13 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          20015           9338         186905
   4-   3       19259561           9338      179845788
   9-   8            118           9337           1109
  10-   9             30           9337            286
  11-  10             30           9337            286
[INFO] [02-20|22:15:49.188] [7/18 Execution] Executed blocks         number=10510852 blk/s=50.550 tx/s=8720.671 Mgas/s=572.399 batch="241.18 MiB" alloc="777.69 MiB" sys="1.19 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          19780          10853         214675
   4-   3       19329847          10853      209786831
   9-   8            118          10852           1291
  10-   9             30          10852            332
  11-  10             30          10852            332
[INFO] [02-20|22:16:17.849] [p2p] GoodPeers                          eth66=0 eth65=0
[INFO] [02-20|22:16:19.192] [7/18 Execution] Executed blocks         number=10512314 blk/s=48.728 tx/s=7241.853 Mgas/s=561.766 batch="269.73 MiB" alloc="1.04 GiB" sys="1.32 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          19963          12315         245847
   4-   3       19468731          12315      239757422
   9-   8            119          12314           1467
  10-   9             30          12314            377
  11-  10             30          12314            377
[INFO] [02-20|22:16:49.188] [7/18 Execution] Executed blocks         number=10513839 blk/s=50.839 tx/s=9290.210 Mgas/s=583.752 batch="298.00 MiB" alloc="899.08 MiB" sys="1.33 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          19782          13840         273791
   4-   3       19488777          13840      269724686
   9-   8            119          13839           1648
  10-   9             30          13839            424
  11-  10             30          13839            424
[INFO] [02-20|22:17:19.184] [7/18 Execution] Executed blocks         number=10515441 blk/s=53.408 tx/s=10551.370 Mgas/s=611.039 batch="328.32 MiB" alloc="732.20 MiB" sys="1.52 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          18853          15442         291141
   4-   3       19408191          15442      299701289
   9-   8            118          15441           1834
  10-   9             30          15441            473
  11-  10             30          15441            473
[INFO] [02-20|22:17:49.179] [7/18 Execution] Executed blocks         number=10516940 blk/s=49.975 tx/s=8904.760 Mgas/s=574.288 batch="356.25 MiB" alloc="951.02 MiB" sys="1.59 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          18719          16941         317132
   4-   3       19459824          16941      329668892
   9-   8            118          16940           2007
  10-   9             30          16940            519
  11-  10             30          16940            519
[INFO] [02-20|22:18:17.849] [p2p] GoodPeers                          eth66=0 eth65=0
[INFO] [02-20|22:18:19.181] [7/18 Execution] Executed blocks         number=10518423 blk/s=49.430 tx/s=7754.121 Mgas/s=563.068 batch="382.84 MiB" alloc="1.26 GiB" sys="1.66 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          20780          18424         382852
   4-   3       19518228          18424      359603844
   9-   8            118          18423           2183
  10-   9             30          18423            564
  11-  10             30          18423            564
[INFO] [02-20|22:18:49.209] [7/18 Execution] Executed blocks         number=10519955 blk/s=51.020 tx/s=8139.155 Mgas/s=586.331 batch="411.01 MiB" alloc="1.20 GiB" sys="1.79 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          19435          19956         387852
   4-   3       19524194          19956      389624820
   9-   8            118          19955           2360
  10-   9             30          19955            611
  11-  10             30          19955            611
[INFO] [02-20|22:19:19.188] [7/18 Execution] Executed blocks         number=10521584 blk/s=54.337 tx/s=10284.311 Mgas/s=618.074 batch="440.08 MiB" alloc="1.40 GiB" sys="1.86 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          19254          21585         415612
   4-   3       19438267          21585      419575000
   9-   8            118          21584           2547
  10-   9             30          21584            661
  11-  10             30          21584            662
[INFO] [02-20|22:19:49.188] [7/18 Execution] Executed blocks         number=10523111 blk/s=50.900 tx/s=9194.606 Mgas/s=588.904 batch="467.97 MiB" alloc="1.49 GiB" sys="1.92 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          18971          23112         438464
   4-   3       19450970          23112      449550841
   9-   8            118          23111           2727
  10-   9             30          23111            708
  11-  10             30          23111            708
[INFO] [02-20|22:20:17.849] [p2p] GoodPeers                          eth66=0 eth65=0
[INFO] [02-20|22:20:19.197] [7/18 Execution] Executed blocks         number=10524544 blk/s=47.752 tx/s=8148.373 Mgas/s=558.018 batch="493.41 MiB" alloc="1.70 GiB" sys="2.05 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          18063          24545         443368
   4-   3       19537725          24545      479553466
   9-   8            118          24544           2899
  10-   9             30          24544            752
  11-  10             30          24544            752
[INFO] [02-20|22:20:49.179] [7/18 Execution] Executed blocks         number=10525975 blk/s=47.729 tx/s=7934.528 Mgas/s=555.415 batch="516.43 MiB" alloc="1.09 GiB" sys="2.12 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          18265          25976         474458
   4-   3       19614370          25976      509502888
   9-   8            118          25975           3068
  10-   9             30          25975            796
  11-  10             30          25975            796
[INFO] [02-20|22:21:19.196] [7/18 Execution] Executed blocks         number=10527311 blk/s=44.508 tx/s=8723.176 Mgas/s=536.812 batch="538.62 MiB" alloc="1.60 GiB" sys="2.19 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          55298          27312        1510299
   4-   3       19715974          27312      538482701
   9-   8            118          27311           3226
  10-   9             30          27311            836
  11-  10             30          27311            838
[INFO] [02-20|22:21:49.198] [7/18 Execution] Executed blocks         number=10528742 blk/s=47.698 tx/s=9046.535 Mgas/s=573.082 batch="564.65 MiB" alloc="1.22 GiB" sys="2.32 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          52889          28743        1520197
   4-   3       19777779          28743      568472702
   9-   8            118          28742           3398
  10-   9             30          28742            880
  11-  10             30          28742            881
[INFO] [02-20|22:22:16.402] Prefetch thread exiting                  error=nil
[INFO] [02-20|22:22:16.439] Prefetch thread exited 
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          50819          30000        1524579
   4-   3       19856936          30000      595708085
   9-   8            118          30000           3547
  10-   9             30          30000            919
  11-  10             30          30000            920
  71-  70           2695       25181187       67883197
  76-  75           5365       28565205      153269395
  99-  98          49489        5351216      264828266
 100-  99         -12233        5351216      -65462569
 101- 100           5795        5351216       31010814
 106- 105           9265        5278636       48908531
 111- 110           2121        3599193        7634937
 112- 111         105389        3599193      379318538
 131- 130        9133908          29019      265056893
 141- 140           1691          57999          98110
[INFO] [02-20|22:22:16.439] Got interrupt, shutting down... 
[INFO] [02-20|22:22:16.440] database closed                          package=predictorDB label=unknown
[INFO] [02-20|22:22:16.724] Successfully update p2p node database    path=/home/route/el15066/erigon/dbdir/erigon/data/nodes/eth66 updated=0 deleted=1
[INFO] [02-20|22:22:16.743] database closed                          label=sentry
[INFO] [02-20|22:22:16.744] Successfully update p2p node database    path=/home/route/el15066/erigon/dbdir/erigon/data/nodes/eth65 updated=0 deleted=1
[INFO] [02-20|22:22:16.761] database closed                          label=sentry
[INFO] [02-20|22:22:17.140] database closed                          label=chaindata
_T1=$(date +%s.%3N)
++ date +%s.%3N
+ _T1=1645395737.213
_D=$(bc <<< "${_T1}-${_T0}")
++ bc
+ _D=599.501

# Release RAM
kill $PID
+ kill 925166

# info.txt
printf 'PRE true\nACC true\nCODE true\nPRED true\nWT 2\nFREQ 3800\nRAM 32\nDISK sx8200\n'"WALL_TIME ${_D}\n" >'../experiments/final/time_PRE_ACC_CODE_PRED_WT_FREQ_RAM_DISK/run_true_true_true_true_2_3800_32_sx8200/info.txt'
+ printf 'PRE true\nACC true\nCODE true\nPRED true\nWT 2\nFREQ 3800\nRAM 32\nDISK sx8200\nWALL_TIME 599.501\n'

# chown
chown 1000:1000 -R '../experiments/final/time_PRE_ACC_CODE_PRED_WT_FREQ_RAM_DISK/run_true_true_true_true_2_3800_32_sx8200/'
+ chown 1000:1000 -R ../experiments/final/time_PRE_ACC_CODE_PRED_WT_FREQ_RAM_DISK/run_true_true_true_true_2_3800_32_sx8200/
