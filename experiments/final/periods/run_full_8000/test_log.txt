

# Freq
for c in 3 4 5 15 16 17; do cpufreq-set -c $c -f '3800MHz' || exit 10; done
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 3 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 4 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 5 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 15 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 16 -f 3800MHz
+ for c in 3 4 5 15 16 17
+ cpufreq-set -c 17 -f 3800MHz

# Prep
cd el15066/erigon/
+ cd el15066/erigon/
sudo -u '#1000' git status | grep -F '/inline_uv'
+ sudo -u '#1000' git status
+ grep -F /inline_uv
Your branch is up to date with 'origin/inline_uv'.

# Globals
cat common/globals_time_PRE_ACC_CODE_PRED_RA_WT.go.template |
  sed 's/%PRE%/true/g' |
  sed 's/%ACC%/true/g' |
  sed 's/%CODE%/true/g' |
  sed 's/%PRED%/true/g' |
  sed 's/%RA%/2/g' |
  sed 's/%WT%/4/g' |
tee common/globals.go
+ cat common/globals_time_PRE_ACC_CODE_PRED_RA_WT.go.template
+ sed s/%PRE%/true/g
+ sed s/%ACC%/true/g
+ sed s/%CODE%/true/g
+ sed s/%PRED%/true/g
+ sed s/%RA%/2/g
+ sed s/%WT%/4/g
+ tee common/globals.go

package common

const BLOCKS = 30_000

const  STORAGE_TRACING = false
const       TX_DUMPING = false
const     CODE_DUMPING = false
const     JUMP_TRACING = false

const PREFETCH_BLOCKS           = true
const BLOCK_READAHEAD           = 2
const PREFETCH_ACCOUNTS         = true
const PREFETCH_CODE             = true
const USE_PREDICTORS            = true
const USE_STORAGE_PREFETCH_FILE = false

const PREFETCH_WORKERS_COUNT = 4

const TRACE_PREDICTED = false

const DEBUG_TX       = false
const DEBUG_TX_BLOCK = 0
const DEBUG_TX_INDEX = 0

const PREDICTOR_CACHE_SIZE      = 1024
const PREDICTOR_GAS_TO_GAZ_RATE = 64 // div 1024
const PREDICTOR_CALL_GAZ_BONUS  = 0
const PREDICTOR_RESERVE_GAZ_DIV = 2
const PREDICTOR_DB_PATH         = "dbdir/predictorDB_new"



// if CODE_DUMPING {
var CONTRACT_CODE       = map[Hash][]byte{}
var CONTRACT_CODE_COUNT = map[Hash]uint{}
var CONTRACT_CODE_ALIAS = map[Address]Hash{}
// }

var CALLID         = -1 // JUMP_TRACING
var CALLID_COUNTER =  0 // JUMP_TRACING

// if JUMP_TRACING {
var JUMP_COUNT         = map[Hash]uint{}
var JUMP_CALLS         = map[Hash]map[int]struct{}{}
var JUMP_DST_CALLCOUNT = map[Hash]map[uint32]map[uint32]map[int]uint{}
// }

# Disk
rm dbdir
+ rm dbdir
ln -s '/media/route/sx8200/' dbdir
+ ln -s /media/route/sx8200/ dbdir

# Caches
echo 3 >/proc/sys/vm/drop_caches
+ echo 3

# Make
sudo -u '#1000' make erigon
+ sudo -u '#1000' make erigon
Building Erigon
rm -f /home/route/el15066/erigon/build/bin/tg # Remove old binary to prevent confusion where users still use it because of the scripts
env GO111MODULE=on go build -trimpath -ldflags "-X github.com/ledgerwatch/erigon/params.GitCommit=8c9ccd401feec75029c402251ac083ce908ed03a -X github.com/ledgerwatch/erigon/params.GitBranch=inline_uv -X github.com/ledgerwatch/erigon/params.GitTag=v2021.08.05-370-g8c9ccd401" -o /home/route/el15066/erigon/build/bin/erigon ./cmd/erigon
Done building.
Run "/home/route/el15066/erigon/build/bin/erigon" to launch Erigon.

# Mkdir
mkdir '../experiments/final/periods/run_full_8000/' || true
+ mkdir ../experiments/final/periods/run_full_8000/

# Sleep
sleep 145
+ sleep 145

# Reserve RAM
[ ! -e /tmp2/fifo ] && mkfifo /tmp2/fifo
+ '[' '!' -e /tmp2/fifo ']'
python3 ../experiments/reserve_ram_until.py '16' >/tmp2/fifo &
PID=$!
+ PID=90846
exec 3</tmp2/fifo
+ exec
+ python3 ../experiments/reserve_ram_until.py 16
read -u 3
+ read -u 3
Will reserve: 46935 MiB
Random: 2933 MiB
Copying all that 14 times
Copying a few more MiB
Done, undershoot by 120 KiB
exec 3>&-
+ exec

# Sleep
sleep 12
+ sleep 12

# Run
_T0=$(date +%s.%3N)
++ date +%s.%3N
+ _T0=1645852265.223
nice --10 taskset -c 3-5,16-17 ./build/bin/erigon --datadir dbdir/erigon/data/ --ethash.dagdir dbdir/erigon/ethash/ --nodiscover --port 30123 |& tee -i '../experiments/final/periods/run_full_8000/erigon_log.txt'
+ nice --10 taskset -c 3-5,16-17 ./build/bin/erigon --datadir dbdir/erigon/data/ --ethash.dagdir dbdir/erigon/ethash/ --nodiscover --port 30123
+ tee -i ../experiments/final/periods/run_full_8000/erigon_log.txt
[INFO] [02-26|05:11:05.275] Build info                               git_branch=inline_uv git_tag=v2021.08.05-370-g8c9ccd401 git_commit=8c9ccd401feec75029c402251ac083ce908ed03a
[INFO] [02-26|05:11:05.275] Starting Erigon on Ethereum mainnet... 
[INFO] [02-26|05:11:05.276] Maximum peer count                       ETH=100 total=100
[INFO] [02-26|05:11:05.276] Set global gas cap                       cap=50000000
[INFO] [02-26|05:11:05.316] Opening Database                         label=chaindata path=dbdir/erigon/data/chaindata
[INFO] [02-26|05:11:05.318] database closed                          label=chaindata
[INFO] [02-26|05:11:05.318] Opening Database                         label=chaindata path=/home/route/el15066/erigon/dbdir/erigon/data/chaindata
[INFO] [02-26|05:11:05.320] Initialised chain configuration          config="{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, London: 12965000, Engine: ethash}"
[INFO] [02-26|05:11:05.320] Disk storage enabled for ethash DAGs     dir=dbdir/erigon/ethash count=2
[INFO] [02-26|05:11:05.320] Initialising Ethereum protocol           network=1
[INFO] [02-26|05:11:05.320] Effective                                prune="--prune="
[INFO] [02-26|05:11:05.320] Starting private RPC server              on=127.0.0.1:9090
[INFO] [02-26|05:11:06.627] Stage Headers                   (Download headers) 
[INFO] [02-26|05:11:06.628] Stage Headers                   Done 
[INFO] [02-26|05:11:06.628] Stage BlockHashes               (Write block hashes) 
[INFO] [02-26|05:11:06.628] Stage BlockHashes               Done 
[INFO] [02-26|05:11:06.628] Stage CreateHeadersSnapshot     disabled. Enable by --snapshot.layout 
[INFO] [02-26|05:11:06.628] Stage Bodies                    (Download block bodies) 
[INFO] [02-26|05:11:06.628] Stage Bodies                    Done 
[INFO] [02-26|05:11:06.628] Stage CreateBodiesSnapshot      disabled. Enable by --snapshot.layout 
[INFO] [02-26|05:11:06.628] Stage Senders                   (Recover senders from tx signatures) 
[INFO] [02-26|05:11:06.628] Stage Senders                   Done 
[INFO] [02-26|05:11:06.628] Stage Execution                 (Execute blocks w/o hash checks) 
[INFO] [02-26|05:11:06.628] Globals                                  STORAGE_TRACING=false TX_DUMPING=false CODE_DUMPING=false JUMP_TRACING=false PREFETCH_BLOCKS=true BLOCK_READAHEAD=2 PREFETCH_ACCOUNTS=true PREFETCH_CODE=true USE_PREDICTORS=true USE_STORAGE_PREFETCH_FILE=false PREFETCH_WORKERS_COUNT=4 TRACE_PREDICTED=false DEBUG_TX=false DEBUG_TX_BLOCK=0 DEBUG_TX_INDEX=0 PREDICTOR_CACHE_SIZE=1024 PREDICTOR_GAS_TO_GAZ_RATE=64 PREDICTOR_RESERVE_GAZ_DIV=2 PREDICTOR_CALL_GAZ_BONUS=0 PREDICTOR_DB_PATH=dbdir/predictorDB_new
[INFO] [02-26|05:11:06.628] [7/18 Execution] Blocks execution        from=7999999 to=8029999
[INFO] [02-26|05:11:06.678] Started P2P networking                   version=66 self="enode://cf90152aad373d1608af933850566e82f8ad78089ffe361b9f94664a081ba07596b6dbf4b38dfdde9f4a7470414f76c803b66ad56e4920db7bb09fa445d3c458@127.0.0.1:30123?discport=0" name=erigon/v2021.08.5-alpha-8c9ccd40/linux-amd64/go1.16.14
[INFO] [02-26|05:11:06.683] Opened database                          package=predictorDB info=../erigon/symbolic/sandbox/envon_test/code//,auto_8000
[INFO] [02-26|05:11:06.688] Started P2P networking                   version=65 self="enode://cf90152aad373d1608af933850566e82f8ad78089ffe361b9f94664a081ba07596b6dbf4b38dfdde9f4a7470414f76c803b66ad56e4920db7bb09fa445d3c458@127.0.0.1:30304?discport=0" name=erigon/v2021.08.5-alpha-8c9ccd40/linux-amd64/go1.16.14
[INFO] [02-26|05:11:36.631] [7/18 Execution] Executed blocks         number=8002378 blk/s=79.293 tx/s=11431.142 Mgas/s=572.816 batch="43.50 MiB" alloc="424.60 MiB" sys="543.98 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          35886           2379          85373
   4-   3       12574888           2379       29915660
   9-   8             76           2378            183
  10-   9             31           2378             75
  11-  10             32           2378             76
[INFO] [02-26|05:12:06.633] [7/18 Execution] Executed blocks         number=8005148 blk/s=92.325 tx/s=8867.029 Mgas/s=585.307 batch="81.91 MiB" alloc="492.24 MiB" sys="679.39 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          31400           5149         161679
   4-   3       11621679           5149       59840025
   9-   8             75           5148            388
  10-   9             31           5148            164
  11-  10             31           5148            161
[INFO] [02-26|05:12:36.638] [7/18 Execution] Executed blocks         number=8007890 blk/s=91.386 tx/s=12807.155 Mgas/s=629.022 batch="119.11 MiB" alloc="449.73 MiB" sys="814.89 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          25404           7891         200467
   4-   3       11380499           7891       89803524
   9-   8             78           7890            620
  10-   9             31           7890            251
  11-  10             31           7890            246
[INFO] [02-26|05:13:05.321] [p2p] GoodPeers                          eth66=0 eth65=0
[INFO] [02-26|05:13:06.629] [7/18 Execution] Executed blocks         number=8010755 blk/s=95.527 tx/s=9410.128 Mgas/s=588.734 batch="155.40 MiB" alloc="638.04 MiB" sys="882.83 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          29754          10756         320037
   4-   3       11126186          10756      119673266
   9-   8             79          10755            853
  10-   9             31          10755            342
  11-  10             31          10755            333
[INFO] [02-26|05:13:36.633] [7/18 Execution] Executed blocks         number=8013707 blk/s=98.387 tx/s=11655.676 Mgas/s=631.656 batch="191.18 MiB" alloc="716.88 MiB" sys="1018.89 MiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          26465          13708         362792
   4-   3       10915681          13708      149632158
   9-   8             80          13707           1110
  10-   9             31          13707            435
  11-  10             30          13707            424
[INFO] [02-26|05:14:06.631] [7/18 Execution] Executed blocks         number=8016277 blk/s=85.675 tx/s=11799.354 Mgas/s=580.449 batch="225.43 MiB" alloc="893.44 MiB" sys="1.19 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          23913          16278         389259
   4-   3       11033338          16278      179600686
   9-   8             82          16277           1344
  10-   9             31          16277            517
  11-  10             30          16277            503
[INFO] [02-26|05:14:36.632] [7/18 Execution] Executed blocks         number=8019140 blk/s=95.429 tx/s=10815.552 Mgas/s=607.939 batch="258.70 MiB" alloc="973.11 MiB" sys="1.26 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          25461          19141         487352
   4-   3       10945171          19141      209501523
   9-   8             83          19140           1592
  10-   9             31          19140            608
  11-  10             30          19140            590
[INFO] [02-26|05:15:05.320] [p2p] GoodPeers                          eth66=0 eth65=0
[INFO] [02-26|05:15:06.635] [7/18 Execution] Executed blocks         number=8021851 blk/s=90.356 tx/s=12933.912 Mgas/s=653.020 batch="292.42 MiB" alloc="766.95 MiB" sys="1.39 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          24159          21852         527937
   4-   3       10958361          21852      239462112
   9-   8             84          21851           1854
  10-   9             31          21851            692
  11-  10             30          21851            673
[INFO] [02-26|05:15:36.639] [7/18 Execution] Executed blocks         number=8024748 blk/s=96.556 tx/s=9984.721 Mgas/s=615.084 batch="323.98 MiB" alloc="1.28 GiB" sys="1.46 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          22833          24749         565100
   4-   3       10886339          24749      269426017
   9-   8             85          24748           2103
  10-   9             31          24748            784
  11-  10             30          24748            763
[INFO] [02-26|05:16:06.632] [7/18 Execution] Executed blocks         number=8027157 blk/s=80.317 tx/s=14084.368 Mgas/s=603.123 batch="345.78 MiB" alloc="965.35 MiB" sys="1.53 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          21168          27158         574902
   4-   3       11024650          27158      299407459
   9-   8             87          27157           2365
  10-   9             31          27157            860
  11-  10             30          27157            837
[INFO] [02-26|05:16:36.632] [7/18 Execution] Executed blocks         number=8029914 blk/s=91.901 tx/s=11938.624 Mgas/s=670.300 batch="373.07 MiB" alloc="1.28 GiB" sys="1.66 GiB"
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          20236          29915         605360
   4-   3       11010337          29915      329374247
   9-   8             87          29914           2630
  10-   9             31          29914            947
  11-  10             30          29914            921
[INFO] [02-26|05:16:37.470] Prefetch thread exiting                  error=nil
[INFO] [02-26|05:16:37.499] Prefetch thread exited 
__TO-FROM ___AVERAGE_ns_ _______COUNT__ _____TOTAL_us_
   1-   0          20189          30000         605684
   4-   3       11008018          30000      330240553
   9-   8             87          30000           2637
  10-   9             31          30000            950
  11-  10             30          30000            924
  71-  70           3777       13180434       49784609
  76-  75           8079       13947565      112686088
  99-  98          20683        3783149       78249756
 100-  99           2098        3783149        7938427
 101- 100           7787        3783149       29462985
 106- 105          11235        3762481       42273299
 111- 110           2661        2287566        6087373
 112- 111          71058        2287566      162550750
 131- 130        2680681          29247       78401894
 141- 140           1478         116622         172388
[INFO] [02-26|05:16:37.499] Got interrupt, shutting down... 
[INFO] [02-26|05:16:37.499] database closed                          package=predictorDB label=unknown
[INFO] [02-26|05:16:37.691] Successfully update p2p node database    path=/home/route/el15066/erigon/dbdir/erigon/data/nodes/eth66 updated=0 deleted=1
[INFO] [02-26|05:16:37.705] database closed                          label=sentry
[INFO] [02-26|05:16:37.755] Successfully update p2p node database    path=/home/route/el15066/erigon/dbdir/erigon/data/nodes/eth65 updated=0 deleted=1
[INFO] [02-26|05:16:37.755] database closed                          label=sentry
[INFO] [02-26|05:16:38.000] database closed                          label=chaindata
_T1=$(date +%s.%3N)
++ date +%s.%3N
+ _T1=1645852598.051
_D=$(bc <<< "${_T1}-${_T0}")
++ bc
+ _D=332.828

# Release RAM
kill $PID
+ kill 90846

# info.txt
printf 'PRE true\nACC true\nCODE true\nPRED true\nWT 4\nFREQ 3800\nRAM 16\nDISK sx8200\n'"WALL_TIME ${_D}\n" >'../experiments/final/periods/run_full_8000/info.txt'
+ printf 'PRE true\nACC true\nCODE true\nPRED true\nWT 4\nFREQ 3800\nRAM 16\nDISK sx8200\nWALL_TIME 332.828\n'

# chown
chown 1000:1000 -R '../experiments/final/periods/run_full_8000/'
+ chown 1000:1000 -R ../experiments/final/periods/run_full_8000/
